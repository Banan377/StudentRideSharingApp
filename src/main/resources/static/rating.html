<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تقييم السائق</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #ccddea;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .hidden {
      display: none !important;
    }

    .full-page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .rating-container {
      width: 340px;
      background-color: #f9fbfb;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
    }

    h1, h2 {
      text-align: center;
      color: #265262;
    }

    h1 {
      margin-bottom: 20px;
    }

    h2 {
      font-size: 16px;
      margin-top: 20px;
    }

    label {
      display: block;
      color: #020003;
      margin-top: 10px;
      text-align: right;
    }

    .profile-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #f0f0f0;
    }

    .profile-circle {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, #487788, #265262);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
    }

    .profile-icon {
      font-size: 30px;
      color: white;
    }

    .driver-name {
      font-size: 18px;
      font-weight: normal;
      color: #265262;
      margin-bottom: 5px;
    }

    .driver-info {
      font-size: 13px;
      color: #666;
    }

    .stars-select {
      display: flex;
      justify-content: center;
      gap: 8px;
      font-size: 28px;
      color: #A5D6E8;
      margin: 15px 0;
      cursor: pointer;
    }

    .stars-select i {
      transition: all 0.2s ease;
    }

    .stars-select i.selected {
      color: #487788 !important;
    }

    .stars-select i:hover {
      transform: scale(1.1);
    }

    .rate-text {
      text-align: center;
      color: #020003;
      margin: 10px 0;
      font-size: 14px;
    }

    .comment-input {
      width: 100%;
      height: 80px;
      border-radius: 8px;
      padding: 7px;
      border: 1px solid #487788;
      resize: none;
      font-size: 14px;
      margin-top: 5px;
      background-color: #f9fbfb;
      font-family: inherit;
      text-align: right;
      box-sizing: border-box;
    }

    .comment-input:focus {
      border-color: #265262;
      outline: none;
    }

    .submit-rating-btn {
      width: 100%;
      background-color: #487788;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
      transition: background 0.2s ease-in-out;
    }

    .submit-rating-btn:hover {
      background-color: #265262;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 12px;
      border-bottom: 1px solid #f0f0f0;
    }

    .page-header h2 {
      color: #265262;
      font-size: 20px;
      margin: 0;
      text-align: center;
      flex: 1;
    }

    .back-btn {
      font-size: 18px;
      color: #487788;
      cursor: pointer;
      background: none;
      border: none;
      padding: 4px;
      transition: color 0.3s;
    }

    .back-btn:hover {
      color: #265262;
    }

    .rating-box {
      margin-top: 15px;
      width: 100%;
    }

    .current-rating {
      text-align: center;
      color: #265262;
      font-weight: 600;
      margin: 10px 0;
      font-size: 14px;
      padding: 6px;
      background-color: #f0f8ff;
      border-radius: 6px;
    }

    .rating-instruction {
      text-align: center;
      color: #666;
      font-size: 12px;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    #successMsg {
      display: none;
      color: #28a745;
      margin-top: 15px;
      padding: 10px;
      background-color: #f8fff9;
      border: 1px solid #c3e6cb;
      border-radius: 8px;
      font-weight: 500;
      text-align: center;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div id="rate-trip-page" class="full-page">
    <div class="rating-container">
      <div class="page-header">
        <button onclick="closePage()" class="back-btn"><i class="fas fa-arrow-right"></i></button>
        <h2>تقييم السائق</h2>
      </div>

      <div class="profile-section">
        <div class="profile-circle">
          <i class="fas fa-user profile-icon"></i>
        </div>
        <div class="driver-name"> </div>
      </div>

      <div class="rating-box">
        <p class="rate-text">كيف كانت تجربتك مع هذا السائق؟</p>

        <div id="current-rating" class="current-rating">التقييم الحالي:  3.5</div>
        
        <p class="rating-instruction">اضغط على النجوم لتقييم السائق</p>
        
        <div id="rating-stars" class="stars-select">
          <i class="fa-regular fa-star" data-value="1"></i>
          <i class="fa-regular fa-star" data-value="2"></i>
          <i class="fa-regular fa-star" data-value="3"></i>
          <i class="fa-regular fa-star" data-value="4"></i>
          <i class="fa-regular fa-star" data-value="5"></i>
        </div>

        <label for="rating-comment">التعليق :</label>
        <textarea id="rating-comment" class="comment-input" placeholder="اكتب تعليقك عن تجربتك مع السائق..."></textarea>

        <button class="submit-rating-btn" onclick="submitTripRating()">إرسال التقييم</button>

        <div id="successMsg">
          تم  التقييم بنجاح!
        </div>
      </div>
    </div>
  </div>

  <script>
    let selectedRating = 0;
    
    document.addEventListener("DOMContentLoaded", () => {
      const stars = document.querySelectorAll("#rating-stars i");
      
      stars.forEach(star => {
        star.addEventListener("click", function() {
          selectedRating = parseInt(this.getAttribute("data-value"));
          
          stars.forEach(s => {
            s.classList.remove("selected");
            s.classList.remove("fa-solid");
            s.classList.add("fa-regular");
          });
          
          for (let i = 0; i < selectedRating; i++) {
            stars[i].classList.add("selected");
            stars[i].classList.remove("fa-regular");
            stars[i].classList.add("fa-solid");
          }
          
          document.getElementById("current-rating").textContent = `التقييم الحالي:  ${selectedRating}.0`;
        });
        
        star.addEventListener("mouseover", function() {
          const value = parseInt(this.getAttribute("data-value"));
          stars.forEach((s, index) => {
            if (index < value) {
              s.style.color = "#487788";
            } else {
              s.style.color = "#A5D6E8";
            }
          });
        });
        
        star.addEventListener("mouseout", function() {
          if (selectedRating === 0) {
            stars.forEach(s => {
              s.style.color = "#A5D6E8";
            });
          } else {
            stars.forEach((s, index) => {
              if (index < selectedRating) {
                s.style.color = "#487788";
              } else {
                s.style.color = "#A5D6E8";
              }
            });
          }
        });
      });
    });
    function submitTripRating() {
  if (selectedRating === 0) {
    alert("الرجاء اختيار عدد النجوم");
    return;
  }

  const comment = document.getElementById("rating-comment").value;
  const driverName = " ";

  const previous = JSON.parse(localStorage.getItem("driverRatings") || "[]");

  previous.push({
    driverName: driverName,
    stars: selectedRating,
    comment: comment,
    date: new Date().toLocaleDateString('ar-SA')
  });

  localStorage.setItem("driverRatings", JSON.stringify(previous));

  document.getElementById("successMsg").style.display = "block";

  //  بدل ما نقفل الصفحة، نرجّع المستخدم للصفحة الرئيسية
  setTimeout(() => {
    window.location.href = "passengerRides.html";
  }, 2000);
}

    
    function closePage() {
      document.getElementById("rate-trip-page").classList.add("hidden");
      document.body.style.overflow = "auto";
      
      const stars = document.querySelectorAll("#rating-stars i");
      stars.forEach(s => {
        s.classList.remove("selected");
        s.classList.remove("fa-solid");
        s.classList.add("fa-regular");
        s.style.color = "#A5D6E8";
      });
      selectedRating = 0;
      document.getElementById("rating-comment").value = "";
      document.getElementById("current-rating").textContent = "التقييم الحالي: 3.5";
      document.getElementById("successMsg").style.display = "none";
    }













  </script>
<script src="payment-to-rating.js"></script>
<script src="rating-connector.js"></script>
<script src="rating-bridge.js"></script>
<script src="rating-connector.js"></script>
</body>
</html>

