
<!DOCTYPE html>  

<html lang="ar" dir="rtl">  
<head>  
    <meta charset="UTF-8">  
    <title>Ø¯ÙØ¹ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø±Ø­Ù„Ø©</title>  
    <link rel="stylesheet" href="payment.css">  
</head>  
<body>  

<div class="container">  

```
<h1>Ø¯ÙØ¹ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø±Ø­Ù„Ø©</h1>  

<label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒÙ„ÙØ© Ø§Ù„Ø±Ø­Ù„Ø© Ù„ÙƒÙ„ Ø±Ø§ÙƒØ¨:</label>  
<input type="text" id="farePerPassenger" readonly />  

<h2>Ø§Ø®ØªØ± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹:</h2>  

<div class="payment-methods">  
    <label>  
        <input type="radio" name="pay" value="Card" onclick="togglePaymentFields()"> Ø¨Ø·Ø§Ù‚Ø©  
    </label>  
    <label>  
        <input type="radio" name="pay" value="Wallet" onclick="togglePaymentFields()"> Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©  
    </label>  
    <label>  
        <input type="radio" name="pay" value="Cash" onclick="togglePaymentFields()"> ÙƒØ§Ø´  
    </label>  
</div>  

  
<div id="cardFields" style="display:none; margin-top: 15px;">  
    <label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</label>  
    <input type="text" id="cardNumber" placeholder="xxxx xxxx xxxx xxxx">  

    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</label>  
    <input type="text" id="expiry" placeholder="MM/YY">  

    <label>Ø±Ù…Ø² CVV:</label>  
    <input type="text" id="cvv" placeholder="123">  
</div>  

<button onclick="processPayment()">Ø§Ø¯ÙØ¹ Ø§Ù„Ø¢Ù†</button>  

<h2 id="successMsg" style="display:none; color:green; margin-top:15px;">  
     ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­  
</h2>  
```

</div>  

<script>  
    
    let calculatedFare = 85;     
    document.getElementById("farePerPassenger").value = calculatedFare + " Ø±ÙŠØ§Ù„";  

    function togglePaymentFields() {  
        let payment = document.querySelector("input[name='pay']:checked").value;  
        let cardSection = document.getElementById("cardFields");  

        if (payment === "Card") {  
            cardSection.style.display = "block";  

            let savedCard = localStorage.getItem("userCard");  
            if (savedCard) {  
                let cardData = JSON.parse(savedCard);  
                document.getElementById("cardNumber").value = cardData.number;  
                document.getElementById("expiry").value = cardData.expiry;  
                document.getElementById("cvv").value = cardData.cvv;  
            }  
        } else {  
            cardSection.style.display = "none";  
        }  
    }  

    function processPayment() {  
        let payment = document.querySelector("input[name='pay']:checked");  
        if (!payment) {  
            alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹");  
            return;  
        }  

        if (payment.value === "Card") {  
            let number = document.getElementById("cardNumber").value;  
            let expiry = document.getElementById("expiry").value;  
            let cvv = document.getElementById("cvv").value;  

            if (!number || !expiry || !cvv) {  
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙƒØ§Ù…Ù„Ø©");  
                return;  
            }  

            // Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©  
            let cardData = { number, expiry, cvv };  
            localStorage.setItem("userCard", JSON.stringify(cardData));  
        }  

        document.getElementById("successMsg").style.display = "block";  
    }  



async function sendToBackend(paymentData) {
    try {
        console.log('ğŸ”„ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯:', paymentData);
        
        const response = await fetch('http://localhost:8083/api/payment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(paymentData)
        });
        
        const result = await response.json();
        console.log(' Ù†Ø¯:', result);
        
        const msg = document.getElementById("successMsg");
        msg.innerHTML = `${result.message}<br>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹: ${result.transactionId}`;
        msg.style.display = "block";
        
    } catch (error) {
        console.error(' Ø®Ø·Ø£:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„  ');
    }
}

// Ø¹Ø¯Ù„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© processPayment
const originalProcessPayment = processPayment;
processPayment = async function() {
    // ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ
    if (!document.querySelector("input[name='pay']:checked")) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹");
        return;
    }
    
    const paymentMethod = document.querySelector("input[name='pay']:checked").value;
    const paymentData = {
        amount: 85,
        method: paymentMethod,
        timestamp: new Date().toISOString()
    };
    
    if (paymentMethod === "Card") {
        const number = document.getElementById("cardNumber").value;
        const expiry = document.getElementById("expiry").value;
        const cvv = document.getElementById("cvv").value;
        
        if (!number || !expiry || !cvv) {
            alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙƒØ§Ù…Ù„Ø©");
            return;
        }
        
        paymentData.cardNumber = number;
        paymentData.expiry = expiry;
        paymentData.cvv = cvv;
        
        localStorage.setItem("userCard", JSON.stringify({ number, expiry, cvv }));
    }
    
    await sendToBackend(paymentData);
};









</script>  
<script src="payment-to-rating.js"></script>

</body>  
</html>  
